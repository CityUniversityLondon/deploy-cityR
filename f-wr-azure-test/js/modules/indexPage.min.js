CITY.indexPage=function(y,b){return{init:function(){var e,n=b("html, body"),a=b(".index-form"),l=b("#index-query",a),r=b("#results-wrapper"),p=r.find("#results"),s=b("#current-query"),d=b("#active-filters"),c=b("#filtered-by"),t=b("#reload"),o=b("<span/>",{class:"loader",id:"course-loader",text:"loading..."}),f=null,u=b("<li/>",{class:"no-results hidden",html:'<p>Sorry, your search has resulted in 0 matches. Try selecting fewer filters or <a href="" id="reload">Start Again<span>Refresh Page</span></a>'}),m=a.attr("id").replace("-form",""),i=a.find("#collection").val(),h=null;function v(){a.find(":radio:checked").add(":checkbox:checked",a).not("#all-dates").not(".hidden").each(function(){var t=b(this),e=t.parent().text();b('<li class="active-filter"></li>').html('<a href="#" title="remove this filter">'+e+'<span class="close">remove</span></a>').click(function(e){return t.attr("checked",!1),a.submit(),!1}).appendTo(d)})}function x(e,t,a){var i;return b.param(e),l.val()||(i=e.length,e[0]={name:"",value:""},e[i]={name:"landing",value:"true"}),r.addClass("loading").prepend(o),d.empty("slow"),s.addClass("loading"),n.animate({scrollTop:0},"slow"),v(),1<=d.children().length?c.show():c.hide(),!0}function g(e,t,a,i){if(r.removeClass("loading"),p.empty(),o.remove(),l.attr("name","query"),b(e).find("total_matching").each(function(){f=b(this).text()}),h=0!==l.val().length?l.val():"All "+m,0===b(e).find("result").length)return s.html("No results found for: <strong>"+h+"</strong>"),u.addClass("visible").removeClass("hidden"),void p.append(u);"events"===m||"concerts"===m||"careers"===m?function(e){var t,a,i,n,l,r,s,d,c,o,f,u,m,h="";e.find("result").each(function(){m=b(this),t=m.find("title").text(),r=m.find("md[f='B']").text(),a=m.find("md[f='c']").text(),i=m.find("md[f='y']").text(),n=m.find("live_url").text(),s=m.find("md[f='J']").text(),d=m.find("md[f='K']").text(),c=m.find("md[f='G']").text(),o=m.find("md[f='H']").text(),f=m.find("md[f='I']").text(),m.find("md[f='E']").text(),u=m.find("md[f='M']").text(),l=m.find("md[f='N']").text(),h+='<li class="vevent event"><div class="date"><p class="date-month"><abbr class="dtstart" title="'+r+'">'+o+" "+f+'</abbr></p><p class="date-day-no">'+c+'</p><p class="date-day">'+d+"</p>"+(l="1"===l||"0"===l?"":'<span class="duration">'+l+" days</span>")+'</div><div class="event-details"><h2><a href="'+n+'" title="'+t+'" class="summary">'+t+'</a></h2><p class="time">'+s+'</p><p class="category">Category: '+i+'</p><p class="audience">Open to: '+u+'</p><p class="event-summary">'+a+"</p></div></li>"}),p.html(h)}(b(e)):"news"===m?function(e){var t,a,i,n,l,r,s,d="";e.find("result").each(function(){s=b(this),t=s.find("title").text(),a=0===s.find("md[f='c']").text().length?"":s.find("md[f='c']").text(),s.find("md[f='y']").text(),i=s.find("live_url").text(),r=s.find("md[f='d']").text(),s.find("md[f='E']").text(),n=s.find("md[f='G']").text(),l=0===n.length?"":'<img src="'+n+'"/>',d+='<li class="article">'+l+'<h2><a href="'+i+'" title="'+t+'" class="summary">'+t+"</a></h2><p>"+a+'</p><p class="pub-date">'+r+"</p></li>"}),p.html(d)}(b(e)):y.debug("form type not defined"),s.removeClass("loading").html(f+" results found for: <strong>"+h+"</strong>")}e=function(){var e={beforeSubmit:x,success:g,dataType:"xml",clearForm:!1,resetForm:!1,url:"//www.city.ac.uk/api/search.xml?"};a.find("input:checkbox, input:radio").click(function(e){a.submit()}),a.ajaxForm(e)},0!==a.length&&(t.live("click",function(){location.reload()}),b("li",p).live("click",function(){return window.location=b(this).find("a").attr("href"),!1}),a.find("input").attr("autocomplete","off"),b(".apply-filter",a).remove(),a.find(".secondary-filters").hide().after(b('<a href="#" class="reveal">Show All...</a>')),b(".reveal").live("click",function(e){var t=b(e.target),a=b(e.target).prev();return t.hasClass("active")?(t.removeClass("active").text("Show More..."),a.hide()):(t.addClass("active").text("Show Fewer..."),a.show("slow")),!1}),v(),y.initMultiAccordion("h3",a,1),yepnope({load:"lib/jquery/plugins/jquery.form.js",callback:e}),y.searchAutoComplete(a,l,i))}}}(CITY,jQuery),CITY.indexPage.init();