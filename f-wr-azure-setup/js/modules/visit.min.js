CITY.visit=function(e,l){var i=new google.maps.LatLng(51.527761,-.103283),g=l("#map-container"),t={zoom:17,key:"AIzaSyBvg6r1x2ZRKPAsceVaKPlg6tO20QiBDpo",center:i,mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!0,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},navigationControl:!0},c=new google.maps.Map(document.getElementById("map-canvas"),t),p=l("#map-search"),u=new google.maps.InfoWindow({maxWidth:400}),d={bigMarkersArray:[],bigBuildingsArray:[],buildingsObj:{},buildings:{toggler:null,markersArray:[],zoomLevel:17,list:""},libraries:{toggler:l("#toggle-libraries"),markersArray:[],zoomLevel:17,list:""},accommodation:{toggler:null,markersArray:[],zoomLevel:17,list:""},lectureTheatres:{toggler:null,markersArray:[],zoomLevel:17,list:""},studentCentre:{toggler:l("#toggle-studentCentre"),markersArray:[],zoomLevel:17,list:""},sports:{toggler:null,markersArray:[],zoomLevel:17,list:""},computerLabs:{toggler:l("#toggle-computerLabs"),markersArray:[],zoomLevel:17,list:""}},n={cycleHire:{src:"http://webapps.city.ac.uk/matrix/maps/cycle-hire.php",toggler:l("#cycle-hire"),preserveViewport:!0},bikes:{src:"http://webapps.city.ac.uk/matrix/maps/cycle-parking.kml",toggler:l("#bikes"),preserveViewport:!0},atms:{src:"http://webapps.city.ac.uk/matrix/maps/atms.kml",toggler:l("#cash-points"),preserveViewport:!0}},m=function(e){var n,i=e.getState();l.each(i,function(t,e){"0"!==t?l.each(d.buildingsObj,function(e,i){t===e&&(n=i,function(e){var i;if(e)for(i in e)e.hasOwnProperty(i)&&"function"!=typeof e[i]&&e[i].setMap(null)}(d.bigMarkersArray),n.setVisible(!0),u.setContent(n.infoHtml),u.open(c,n),c.panTo(n.position),n.setMap(c))}):u.close()})},f=function(e){var i={};e&&("string"==typeof e?i[e]=1:e.hasOwnProperty("id")?i[e.id]=1:i[0]=1,l.bbq.pushState(i,2))},h=function(e,i){var t="";return e.children().each(function(){return this.nodeName!=i||(t=l(this).text(),!1)}),t},r=function(e,i,t){var n,r,o={},a=[],s={};l(e).find("item").each(function(){n=l(this),o.index=1,o.name=n.find("title").text(),o.linkHref=n.find("link").text(),o.description=n.find("description").text(),o.icon=h(n,"CUL:icon"),o.category=n.find("category").text(),o.id=n.find("guid").text(),o.buildingPrefix=h(n,"CUL:buildingPrefix").replace(/^\s+|\s+$/g,""),o.hexColour=h(n,"CUL:hexColour").replace(/^\s+|\s+$/g,""),o.geoLat=h(n,"geo:lat"),o.geoLong=h(n,"geo:long"),o.point=new google.maps.LatLng(parseFloat(o.geoLat),parseFloat(o.geoLong)),r=function(e){var i,t,n,r="#"+e.category,o="";return o=0!==e.linkHref.length?'<div id="info-window" style="min-height: 100px;"><h3><a href="'+e.linkHref+'">'+e.name+"</a></h3>":'<div id="info-window" style="min-height: 100px;"><h3>'+e.name+"</h3>",0!==e.buildingPrefix.length&&(o+='<p class="building-prefix"><strong>Rooms beginning: '+e.buildingPrefix+"</strong></p>",e.buildingPrefix="("+e.buildingPrefix+")"),o+=e.description+"</div>",(i=new google.maps.Marker({map:e.map,position:e.point,icon:e.icon,animation:google.maps.Animation.DROP})).set("id",e.id),i.set("infoHtml",o),google.maps.event.addListener(i,"click",function(e){return f(i)}),t=l("<li />",{id:"building-"+e.id,class:"building"}),n=l("<a />",{href:"#",html:"<span>"+e.name+" "+e.buildingPrefix+"</span>",click:function(e){return f(l(e.target).parents("li").attr("id").replace("building-","")),!1},css:{background:"transparent url("+e.icon+"?v=1123) no-repeat left center"}}),t.append(n).appendTo(r),i}(o),"buildings"!==o.category?d.bigMarkersArray.push(r):d.bigBuildingsArray.push(r),d.buildingsObj[r.id]=r,a.push(o.name),s[o.name]=o.id,d[o.category]?d[o.category].markersArray.push(r):d[o.category]=function(e){this.toggler=null,this.markersArray=[],this.zoomLevel=17}(o.category)}),p.autocomplete({source:a,select:function(e){setTimeout(function(){var e=p.val();p.blur(),e in s&&f(s[e])},0)}}).focusin(function(){p.attr("value","")}),l("#vs-button").click(function(){p.focus()}),google.maps.event.addListener(u,"closeclick",function(){f(u)}),function(e){var i;if(e)for(i in e)e.hasOwnProperty(i)&&"function"!=typeof e[i]&&e[i].setMap(c)}(d.bigBuildingsArray),g.removeClass("loading").children(".loading-fa-icon").remove(),l(window).bind("hashchange",m),l(window).trigger("hashchange")};return{init:function(){g.addClass("loading").append(l('<i class="fa fa-refresh fa-spin loading-fa-icon"></i>')),function(e){l.each(e,function(){var i=this.toggler,t=new google.maps.KmlLayer(this.src,{preserveViewport:this.preserveViewport});i.click(function(e){return i.toggleClass("enabled"),t.setMap(i.hasClass("enabled")?c:null),!1})})}(n),l.ajax({type:"GET",url:"https://www.city.ac.uk/about/campus-map/feeds/locations",dataType:"xml",success:r}),l("#filter").accordion({collapsible:!0,autoHeight:!1,clearStyle:!0,active:!1}),l("#journey-link").bind("click",function(e){e.preventDefault(),l("html, body").animate({scrollTop:l("#journey-planner").offset().top},1e3)})},cityLayers:d,infoWindow:u,map:c}}(CITY,jQuery),CITY.visit.init();